<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cognito - Attendance Records</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="/static/styles/assets/bootstrap/css/bootstrap.min.css">
  <link href="{{ url_for('static', filename='styles/fras-theme.css') }}" rel="stylesheet" type="text/css" />
</head>

<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="/admin">
        <h3 style="color: var(--accent-green); margin: 0; font-weight: 700; letter-spacing: 2px;">Cognito</h3>
      </a>
      <div style="color: grey;">
        <a href="/admin" style="color: var(--text-primary); text-decoration: none;">Dashboard</a>
      </div>
      <div style="display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-list fa-2x" style="color: #666;"></i>
      </div>
    </div>
  </nav>

  <div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>Today's Attendance</h2>
      <div style="font-size: 0.9rem; color: #888;">Live Data</div>
    </div>

    <div class="table-responsive"
      style="background: var(--bg-card); padding: 1rem; border-radius: 15px; border: 1px solid #333;">
      <table class="table table-borderless" id="attendance-table" style="color: white;">
        <thead>
          <tr style="border-bottom: 1px solid #444;">
            <th style="color: var(--accent-green);">ID Number</th>
            <th style="color: var(--accent-green);">Student Name</th>
            <th style="color: var(--accent-green);">Major</th>
            <th style="color: var(--accent-green);">Status</th>
          </tr>
        </thead>
        <tbody>
          {% if data %}
          {% for i in range(data|length) %}
          <tr style="border-bottom: 1px solid #222;">
            <td><span style="background: #333; padding: 5px 10px; border-radius: 5px; font-family: monospace;">{{
                data[i][0]['id'] }}</span></td>
            <td>
              <div style="font-weight: bold;">{{ data[i][0]['name'] }}</div>
            </td>
            <td style="color: #aaa;">{{ data[i][0]['major'] }}</td>
            <td>
              <span style="color: var(--accent-green);"><i class="fas fa-check-circle"></i> Present</span>
            </td>
          </tr>
          {% endfor %}
          {% else %}
          <tr>
            <td colspan="4" class="text-center" style="color: #666; padding: 2rem;">No attendance marked yet today.</td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    <!-- Actions -->
    <div class="mt-4 d-flex gap-3 justify-content-end">
      <form method="POST" style="display: flex; gap: 10px;">
        <button class="btn btn-outline-danger" name="button_admin" value="VALUE2"
          style="border: 1px solid #555; color: #ff6666;">
          <i class="fas fa-trash"></i> Clear List
        </button>
        <button type="button" id="download-csv-button" class="btn btn-primary" style="width: auto; margin: 0;">
          <i class="fas fa-download"></i> Download CSV
        </button>
      </form>
    </div>
  </div>

  <script src="/static/styles/assets/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script>
    document.getElementById('download-csv-button').addEventListener('click', function () {
      var csv = 'ID,Name,Major,Status\n';
      var table = document.getElementById('attendance-table');
      // Logic would need to walk through table rows
      var rows = table.querySelectorAll('tbody tr');
      rows.forEach(row => {
        var cells = row.querySelectorAll('td');
        if (cells.length > 1) {
          csv += cells[0].innerText + ',' + cells[1].innerText + ',' + cells[2].innerText + ',Present\n';
        }
      });

      var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      saveAs(blob, 'attendance_log.csv');
    });
  </script>
</body>

</html>